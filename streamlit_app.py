# app.py
import streamlit as st
import pandas as pd
import numpy as np

# -------------------- íŽ˜ì´ì§€ ì„¤ì • --------------------
# íŽ˜ì´ì§€ì˜ ì œëª©, ì•„ì´ì½˜, ë ˆì´ì•„ì›ƒì„ ì„¤ì •í•©ë‹ˆë‹¤.
# 'wide' ë ˆì´ì•„ì›ƒì€ ì½˜í…ì¸ ê°€ í™”ë©´ ì „ì²´ ë„ˆë¹„ë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•©ë‹ˆë‹¤.
st.set_page_config(
    page_title="ì¸í„°ëž™í‹°ë¸Œ ë°ì´í„° ëŒ€ì‹œë³´ë“œ",
    page_icon="ðŸ“Š",
    layout="wide",
)

# -------------------- ë°ì´í„° ìºì‹± --------------------
# Streamlitì˜ ìºì‹± ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ë¡œë”©ê³¼ ê°™ì€
# ë¹„ìš©ì´ ë§Žì´ ë“œëŠ” ìž‘ì—…ì„ ìµœì í™”í•©ë‹ˆë‹¤.
# í•œë²ˆ ë¡œë“œëœ ë°ì´í„°ëŠ” ìž…ë ¥ ë§¤ê°œë³€ìˆ˜ê°€ ë³€ê²½ë˜ì§€ ì•ŠëŠ” í•œ ë‹¤ì‹œ ë¡œë“œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
@st.cache_data
def load_data():
    """
    ìƒ˜í”Œ ë°ì´í„°í”„ë ˆìž„ì„ ìƒì„±í•˜ê³  ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ìž…ë‹ˆë‹¤.
    ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì´ ë¶€ë¶„ì—ì„œ CSV íŒŒì¼ì´ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ë¡œë“œí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
    """
    data = pd.DataFrame({
        'ì¹´í…Œê³ ë¦¬': np.random.choice(['A', 'B', 'C'], 100),
        'ê°’': np.random.randn(100).cumsum(),
        'ë‚ ì§œ': pd.to_datetime(pd.date_range('2023-01-01', periods=100, freq='D'))
    })
    return data

# -------------------- ì‚¬ì´ë“œë°” --------------------
# st.sidebarë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ì»¨íŠ¸ë¡¤ì„ ì‚¬ì´ë“œë°”ì— ë°°ì¹˜í•©ë‹ˆë‹¤.
# ì´ëŠ” ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ì„ ê¹”ë”í•˜ê²Œ ìœ ì§€í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.
with st.sidebar:
    st.header("í•„í„° ì˜µì…˜")

    # ë°ì´í„° ë¡œë“œ
    df = load_data()

    # ì¹´í…Œê³ ë¦¬ í•„í„°
    # ë©€í‹°ì…€ë ‰íŠ¸ ìœ„ì ¯ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìžê°€ í•˜ë‚˜ ì´ìƒì˜ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•  ìˆ˜ ìžˆë„ë¡ í•©ë‹ˆë‹¤.
    selected_categories = st.multiselect(
        "ì¹´í…Œê³ ë¦¬ ì„ íƒ",
        options=df['ì¹´í…Œê³ ë¦¬'].unique(),
        default=df['ì¹´í…Œê³ ë¦¬'].unique()
    )

    # ë‚ ì§œ ë²”ìœ„ í•„í„°
    # ë‚ ì§œ ìž…ë ¥ ìœ„ì ¯ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìžê°€ ë‚ ì§œ ë²”ìœ„ë¥¼ ì„ íƒí•  ìˆ˜ ìžˆë„ë¡ í•©ë‹ˆë‹¤.
    start_date = st.date_input(
        "ì‹œìž‘ ë‚ ì§œ",
        value=df['ë‚ ì§œ'].min(),
        min_value=df['ë‚ ì§œ'].min(),
        max_value=df['ë‚ ì§œ'].max()
    )
    end_date = st.date_input(
        "ì¢…ë£Œ ë‚ ì§œ",
        value=df['ë‚ ì§œ'].max(),
        min_value=df['ë‚ ì§œ'].min(),
        max_value=df['ë‚ ì§œ'].max()
    )

# -------------------- ë°ì´í„° í•„í„°ë§ --------------------
# ì‚¬ìš©ìžê°€ ì‚¬ì´ë“œë°”ì—ì„œ ì„ íƒí•œ ì˜µì…˜ì„ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„°í”„ë ˆìž„ì„ í•„í„°ë§í•©ë‹ˆë‹¤.
# í•„í„°ë§ëœ ë°ì´í„°ëŠ” ìƒˆë¡œìš´ ë³€ìˆ˜ì— ì €ìž¥ë©ë‹ˆë‹¤.
filtered_df = df[
    (df['ì¹´í…Œê³ ë¦¬'].isin(selected_categories)) &
    (pd.to_datetime(df['ë‚ ì§œ']).dt.date >= start_date) &
    (pd.to_datetime(df['ë‚ ì§œ']).dt.date <= end_date)
]

# -------------------- ë©”ì¸ íŽ˜ì´ì§€ --------------------
st.title("ðŸ“Š ì¸í„°ëž™í‹°ë¸Œ ë°ì´í„° ëŒ€ì‹œë³´ë“œ")
st.write("ì‚¬ì´ë“œë°”ì˜ í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ íƒìƒ‰í•´ë³´ì„¸ìš”.")

# ë©”íŠ¸ë¦­ í‘œì‹œ
# st.columnsë¥¼ ì‚¬ìš©í•˜ì—¬ ë ˆì´ì•„ì›ƒì„ ì—¬ëŸ¬ ì—´ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤.
col1, col2, col3 = st.columns(3)
with col1:
    st.metric(label="ì´ ë°ì´í„° ìˆ˜", value=len(filtered_df))
with col2:
    st.metric(label="í‰ê·  ê°’", value=f"{filtered_df['ê°’'].mean():.2f}")
with col3:
    st.metric(label="ìµœëŒ€ ê°’", value=f"{filtered_df['ê°’'].max():.2f}")

st.markdown("---")

# í•„í„°ë§ëœ ë°ì´í„° í…Œì´ë¸” í‘œì‹œ
st.subheader("í•„í„°ë§ëœ ë°ì´í„°")
st.dataframe(filtered_df)

# ë¼ì¸ ì°¨íŠ¸ ì‹œê°í™”
st.subheader("ì‹œê°„ì— ë”°ë¥¸ ê°’ì˜ ë³€í™”")
st.line_chart(filtered_df.set_index('ë‚ ì§œ')['ê°’'])